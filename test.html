<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Zoomable Element</title>
    <style>
      /* http://meyerweb.com/eric/tools/css/reset/ 
          v2.0 | 20110126
          License: none (public domain)
      */

      html, body, div, span, applet, object, iframe,
      h1, h2, h3, h4, h5, h6, p, blockquote, pre,
      a, abbr, acronym, address, big, cite, code,
      del, dfn, em, img, ins, kbd, q, s, samp,
      small, strike, strong, sub, sup, tt, var,
      b, u, i, center,
      dl, dt, dd, ol, ul, li,
      fieldset, form, label, legend,
      table, caption, tbody, tfoot, thead, tr, th, td,
      article, aside, canvas, details, embed, 
      figure, figcaption, footer, header, hgroup, 
      menu, nav, output, ruby, section, summary,
      time, mark, audio, video {
        margin: 0;
        padding: 0;
        border: 0;
        font-size: 100%;
        font: inherit;
        vertical-align: baseline;
      }
      /* HTML5 display-role reset for older browsers */
      article, aside, details, figcaption, figure, 
      footer, header, hgroup, menu, nav, section {
        display: block;
      }
      body {
        line-height: 1;
      }
      ol, ul {
        list-style: none;
      }
      blockquote, q {
        quotes: none;
      }
      blockquote:before, blockquote:after,
      q:before, q:after {
        content: '';
        content: none;
      }
      table {
        border-collapse: collapse;
        border-spacing: 0;
      }










      .zoom-container {
          width: 80vw;
          height: 500px;
          border: none;
          overflow: scroll; /* スクロールを有効にする */
          border: none;
          margin: 0 auto;
          position: relative;
          background-color: silver;
      }

      .content {
        width: 100vw;
        height: 1000px;
        background-color: black;
        transform-origin: center center; /* ズーム起点を中央に */
        position: absolute;
        top: 0;
        left: 0;
        transform: translateX(0, 0) scale(2); /* 初期状態で中央に配置 */
      }

      #zahyou{
        display: block;
        width: 100vw;
        height: 24px;
        margin: calc(500px - 24px) auto;
        padding: 0;

        color: white;
        text-align: center;
        line-height: 24px;
        font-size: 24px;

      }

      .point{
        display: block;
        width: 10px;
        height: 10px;
        margin: 0;
        padding: 0;
        background-color: white;
        border-radius: 50%;

        position: absolute;
      }
    </style>
</head>
<body>
    <div class="zoom-container">
        <div class="content">
          <p id="zahyou">test</p>
          <span class="point" style="top: 400px; left: 300px;"></span>
        </div>
    </div>

    <script>
      const zoomContainer = document.querySelector('.zoom-container');
      const content = document.querySelector('.content');
      zoomContainer.scrollLeft = 99999;
      zoomContainer.scrollTop = 99999;
      zoomContainer.scrollLeft = zoomContainer.scrollLeft / 2;
      zoomContainer.scrollTop = zoomContainer.scrollTop / 2;
      
      const containerWidth = zoomContainer.offsetWidth;
      const containerHeight = zoomContainer.offsetHeight;
      const scrollbarWidth = zoomContainer.offsetWidth - zoomContainer.clientWidth;
      
      const contentWidth = content.offsetWidth;
      const contentHeight = content.offsetHeight;
      
      // ズームスケールの初期値
      var scale = 2;
      var newScale;
      
      // ズーム最大値・最小値
      const maxZoom = 2.5;
      const minZoom = 1;

      // マウスホイールによるズーム
      zoomContainer.addEventListener('wheel', (event) => {
          event.preventDefault();

          // ズーム変化量（マウスホイールの回転量）
          var delta = event.deltaY > 0 ? -0.1 : 0.1;
          
          newScale = scale + delta
          // 最大値処理
          newScale = newScale > maxZoom ? maxZoom : newScale;
          // 最小値処理
          newScale = newScale < minZoom ? minZoom : newScale;

          // console.log("X:" + Number((event.offsetX - contentWidth/2)) + "\tY:" + Number((event.offsetY- contentHeight/2)));
          
          content.style.transformOrigin = String(event.offsetX) + "px " + String(event.offsetY) + "px";
          if(true){
            content.style.transform = `scale(${newScale})`;
          }
          
          
          scale = newScale;
      });











      // zoomContainer.onmousemove = function(event){
      //   document.getElementById("zahyou").textContent = ("X: " + String(event.offsetX - contentWidth/2) + "\tY: " + String(event.offsetY - contentHeight/2));
      // }

      // タッチによるピンチイン・ピンチアウトズーム
      var lastTouchDistance = null;
      var currentTouchDistance;
      var mx;
      var my;

      function getDistance(touches) {
        const dx = touches[0].clientX - touches[1].clientX;
        const dy = touches[0].clientY - touches[1].clientY;
        return Math.sqrt(dx * dx + dy * dy);
      }

      function getMiddle(touches) {
        mx = touches[0].clientX + touches[1].clientX;
        my = touches[0].clientY + touches[1].clientY;
      }

      zoomContainer.addEventListener('touchstart', (event) => {
        if (event.touches.length === 2) {
          lastTouchDistance = getDistance(event.touches);
          // alert("touchStart");
        }
      });

      zoomContainer.addEventListener('touchmove', (event) => {
        if (event.touches.length === 2) {
        // alert("move Start");
          event.preventDefault();

          currentTouchDistance = getDistance(event.touches);
          getMiddle(event.touches);
          // document.getElementById("zahyou").textContent = currentTouchDistance;
          var deltaScale = currentTouchDistance / lastTouchDistance;

          document.getElementById("zahyou").textContent = scale;
          
          newScale = scale * deltaScale;
          // 最大値処理
          newScale = newScale > maxZoom ? maxZoom : newScale;
          // 最小値処理
          newScale = newScale < minZoom ? minZoom : newScale;

          // console.log("X:" + Number((event.offsetX - contentWidth/2)) + "\tY:" + Number((event.offsetY- contentHeight/2)));
          
          content.style.transformOrigin = mx + "px " + my + "px";
          // content.style.transformOrigin = "center center";
          if(true){
            content.style.transform = `scale(${newScale})`;
          }

          lastTouchDistance = currentTouchDistance;
          scale = newScale;
        }
      });

      zoomContainer.addEventListener('touchend', () => {
        if (event.touches.length === 2) {
          lastTouchDistance = null;
        }
      });
    </script>
</body>
</html>
